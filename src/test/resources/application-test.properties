# Test configuration - use MySQL database for better transaction isolation
spring.application.name=QuizMaker-Test
# Import .env file for test environment variables
spring.config.import=optional:classpath:secret.properties,optional:file:.env[.properties]
# MySQL database for testing (using separate test database)
spring.datasource.url=jdbc:mysql://localhost:3306/quizmaker_test?useSSL=false&allowPublicKeyRetrieval=true&serverTimezone=UTC&createDatabaseIfNotExist=true
spring.datasource.username=bestuser
spring.datasource.password=bestuser
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver
# Connection pool settings for CI/test environments
# Reduced pool size to avoid "Too many connections" errors in parallel test execution
# MySQL default max_connections is 151, so we need to be conservative
spring.datasource.hikari.maximum-pool-size=10
spring.datasource.hikari.minimum-idle=2
spring.datasource.hikari.connection-timeout=30000
spring.datasource.hikari.validation-timeout=5000
spring.datasource.hikari.idle-timeout=300000
spring.datasource.hikari.max-lifetime=900000
spring.datasource.hikari.leak-detection-threshold=30000

# JPA / Hibernate for testing
spring.jpa.database-platform=org.hibernate.dialect.MySQL8Dialect
# Use Hibernate to manage schema in tests for simplicity
spring.jpa.hibernate.ddl-auto=create-drop
spring.flyway.enabled=false
spring.jpa.show-sql=false
quiz.default-category-id=00000000-0000-0000-0000-000000000001

# Disable debug logging in tests
logging.level.org.springframework=WARN
logging.level.uk.gegc.quizmaker=INFO
logging.level.org.hibernate.SQL=DEBUG
logging.level.org.hibernate.type.descriptor.sql.BasicBinder=TRACE
spring.jpa.properties.hibernate.format_sql=false
logging.level.org.springframework.orm.jpa=WARN

# JWT settings for testing
jwt.access-expiration-ms=43200000
jwt.refresh-expiration-ms=604800000

# Enable OpenAPI docs for API documentation tests
springdoc.api-docs.enabled=true
springdoc.swagger-ui.enabled=true

# Disable management endpoints in tests
management.endpoints.web.exposure.include=health

# Document processing test configuration (matching main app properties)
document.chunking.default-max-chunk-size=3000
document.chunking.default-strategy=SIZE_BASED

# File upload test configuration
spring.servlet.multipart.max-file-size=10MB
spring.servlet.multipart.max-request-size=10MB

# Logging for tests
logging.level.uk.gegc.quizmaker.service.document=DEBUG
logging.level.uk.gegc.quizmaker.controller=DEBUG

# Async Configuration for Tests (smaller pools for testing)
async.ai.core-pool-size=8
async.ai.max-pool-size=8
async.ai.queue-capacity=10
async.ai.keep-alive-seconds=30

async.general.core-pool-size=4
async.general.max-pool-size=4
async.general.queue-capacity=10
async.general.keep-alive-seconds=30

# MySQL specific settings for testing
spring.jpa.properties.hibernate.connection.isolation=2
spring.jpa.properties.hibernate.jdbc.batch_size=20
spring.jpa.properties.hibernate.order_inserts=true
spring.jpa.properties.hibernate.order_updates=true

# Feature flags for testing
quizmaker.features.billing=true
